import{g as o,j as y,r as m,t as u,f as C,i,c,F,d as k,e as P,k as H,b as v,s as B,u as X,h as O,a as T,l as Y,p as Z,S as ee}from"./web.Br82kJRb.js";import{S as j,t as te,c as ne}from"./techniqueStore.OpD8ADmx.js";import{c as R,d as re,S as A,C as le}from"./CheckButton.BJBWlJH9.js";import{p as ae}from"./playArrayBuffer.D6vWLOse.js";var ie=u('<svg xmlns=http://www.w3.org/2000/svg width=24 height=24><path d="M8 5v14l11-7z">');const ce=(e={})=>(()=>{var t=o(ie);return y(t,e,!0,!0),m(),t})();var se=u('<svg xmlns=http://www.w3.org/2000/svg width=24 height=24><path d="M6 19h4V5H6zm8-14v14h4V5z">');const oe=(e={})=>(()=>{var t=o(se);return y(t,e,!0,!0),m(),t})();var ue=u('<svg xmlns=http://www.w3.org/2000/svg width=24 height=24><path d="m6 18 8.5-6L6 6zM16 6v12h2V6z">');const de=(e={})=>(()=>{var t=o(ue);return y(t,e,!0,!0),m(),t})();var he=u('<svg xmlns=http://www.w3.org/2000/svg width=24 height=24><path d="M6 6h2v12H6zm3.5 6 8.5 6V6z">');const ge=(e={})=>(()=>{var t=o(he);return y(t,e,!0,!0),m(),t})();var ve=u('<svg xmlns=http://www.w3.org/2000/svg width=24 height=24><path d="M19.03 3.56c-1.67-1.39-3.74-2.3-6.03-2.51v2.01c1.73.19 3.31.88 4.61 1.92zM11 3.06V1.05c-2.29.2-4.36 1.12-6.03 2.51l1.42 1.42A8.93 8.93 0 0 1 11 3.06M4.98 6.39 3.56 4.97C2.17 6.64 1.26 8.71 1.05 11h2.01c.19-1.73.88-3.31 1.92-4.61M20.94 11h2.01c-.21-2.29-1.12-4.36-2.51-6.03l-1.42 1.42A8.93 8.93 0 0 1 20.94 11M7 12l3.44 1.56L12 17l1.56-3.44L17 12l-3.44-1.56L12 7l-1.56 3.44z"></path><path d="M12 21a8.96 8.96 0 0 1-7.46-4H7v-2H1v6h2v-2.7c1.99 2.84 5.27 4.7 9 4.7 4.87 0 9-3.17 10.44-7.56l-1.96-.45C19.25 18.48 15.92 21 12 21">');const $e=(e={})=>(()=>{var t=o(ve);return y(t,e,!0,!0),m(),t})();var fe=u('<svg xmlns=http://www.w3.org/2000/svg width=24 height=24><path d="m20.38 8.57-1.23 1.85a8 8 0 0 1-.22 7.58H5.07A8 8 0 0 1 15.58 6.85l1.85-1.23A10 10 0 0 0 3.35 19a2 2 0 0 0 1.72 1h13.85a2 2 0 0 0 1.74-1 10 10 0 0 0-.27-10.44z"></path><path d="M10.59 15.41a2 2 0 0 0 2.83 0l5.66-8.49-8.49 5.66a2 2 0 0 0 0 2.83">');const xe=(e={})=>(()=>{var t=o(fe);return y(t,e,!0,!0),m(),t})();var be=u('<svg xmlns=http://www.w3.org/2000/svg width=24 height=24><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"></path><path d="M15.97 11.03C14.87 9.79 13.28 9 11.5 9c-2.82 0-5.18 1.95-5.82 4.56l.96.32C7.15 11.66 9.13 10 11.5 10c1.51 0 2.85.68 3.76 1.74L13 14h5V9z">');const me=(e={})=>(()=>{var t=o(be);return y(t,e,!0,!0),m(),t})(),we=["execution","attack","defence","direction"];function q(e){return`${e.execution} ${e.attack} ${e.defence} ${e.direction}`.replace(/\W/g,"_")}const ye=["execution","attack","defence"];function D(e,t){const n=e.direction===j?ye:we;return t==null?n:e.execution!==t.execution?n.slice(0):e.attack!==t.attack?n.slice(1):e.defence!==t.defence?n.slice(2):e.direction!==t.direction?n.slice(3):n}function*_e(e){let t;for(const n of e){const l=D(n,t);yield{id:q(n),execution:{value:n.execution,relevant:l.includes("execution")},attack:{value:n.attack,relevant:l.includes("attack")},defence:{value:n.defence,relevant:l.includes("defence")},direction:{value:n.direction,relevant:l.includes("direction")}},t=n}}var pe=u("<ul>"),Se=u("<li><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/>"),Ce=u('<div class="absolute flex items-center top-0 right-0 rounded bg-primary-dark font-bold text-white p-1 origin-top-right text-xs"><!$><!/> <!$><!/>'),ke=u("<div>");const Pe=e=>{const t=C(()=>Array.from(_e(e.techniques)));return(()=>{var n=o(pe);return i(n,c(F,{get each(){return t()},children:l=>c(Te,{entry:l,get isLastTechnique(){return C(()=>e.lastTechnique!=null)()&&l.id==q(e.lastTechnique)},get isNextTechnique(){return C(()=>e.nextTechnique!=null)()&&l.id==q(e.nextTechnique)}})})),k(()=>P(n,R("overflow-y-scroll grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 shadow-lg m-0 py-2 bg-white",e.class))),n})()},Te=e=>{let t;return H(()=>{e.isNextTechnique&&t.scrollIntoView?.({block:"end",inline:"start",behavior:"smooth"})}),(()=>{var n=o(Se),l=n.firstChild,[s,r]=v(l.nextSibling),$=s.nextSibling,[d,f]=v($.nextSibling),x=d.nextSibling,[a,h]=v(x.nextSibling),g=a.nextSibling,[_,I]=v(g.nextSibling),p=_.nextSibling,[N,W]=v(p.nextSibling),V=t;return typeof V=="function"?X(V,n):t=n,i(n,(()=>{var b=C(()=>!!e.isNextTechnique);return()=>b()&&(()=>{var w=o(Ce),L=w.firstChild,[S,U]=v(L.nextSibling),G=S.nextSibling,J=G.nextSibling,[K,Q]=v(J.nextSibling);return i(w,c(me,{class:"fill-current scale-75"}),S,U),i(w,()=>te("reader.upcoming-technique"),K,Q),w})()})(),s,r),i(n,c(z,{get field(){return e.entry.execution},class:"text-sm h-6"}),d,f),i(n,c(z,{get field(){return e.entry.attack},class:"text-sm h-6 z-10"}),a,h),i(n,c(z,{get field(){return e.entry.defence},class:"text-xl h-8"}),_,I),i(n,c(z,{get field(){return e.entry.direction},class:"text-sm h-6"}),N,W),k(b=>{var w=e.entry.id,L=R(e.isLastTechnique&&"bg-primary-lightest outline-primary outline-4 -outline-offset-4","border-primary-light border p-2 pt-4 rounded snap-mandatory","snap-start","relative","overflow-visible","list-none","h-32"),S=e.isLastTechnique;return w!==b.e&&B(n,"id",b.e=w),L!==b.t&&P(n,b.t=L),S!==b.a&&B(n,"aria-current",b.a=S),b},{e:void 0,t:void 0,a:void 0}),n})()},z=e=>(()=>{var t=o(ke);return i(t,()=>e.field.value!==j&&e.field.value),k(()=>P(t,R(e.field.relevant?"text-black font-bold":"text-secondary",e.class))),t})();function qe(e,t){return D(e,t).map(l=>e[l])}const Ie=console.warn.bind(console);async function Le(e){return ze(e,async t=>{for(let s=0;s<2;s++)try{const r=new URL(t,window.location.href);return await(await fetch(r)).arrayBuffer()}catch(r){Ie("Retrying after ",r)}const n=new URL(t,window.location.href);return await(await fetch(n)).arrayBuffer()})}async function ze(e,t){const n=Object.entries(e),l=await Promise.all(n.map(async([s,r])=>[s,await t(r)]));return Object.fromEntries(l)}let E=null;async function Me(e,t){if(E==null)throw new Error("No SpeechPack loaded");await ae(E[e],{abortSignal:t})}async function Ne(e){E=await Le(e)}class Ae{constructor(){this.lastTechnique=void 0,this.abortController=new AbortController}async playTechnique(t){await this.playFiles(qe(t,this.lastTechnique)),this.abortController.signal.aborted||(this.lastTechnique=t)}async playFiles(t){this.abortController.abort();const n=new AbortController;this.abortController=n;for(const l of t){if(n.signal.aborted)return;await Me(l,n.signal)}}async stop(){this.abortController.abort()}}function Ee(e){const[t]=O(async()=>(await Ne(e()),!0)),[n,l]=T(!1),s=new Ae,[r,$]=T(null);return{playing:n,playerLoaded:t,lastTechnique:r,async play(d){l(!0),$(d),await s.playTechnique(d),l(!1)},async stop(){await s.stop()}}}var Re=u('<button><!$><!/><div class="grid grid-cols-3 w-24 gap-1 h-6">'),Ve=u("<div>");const M=["slow","normal","fast"],Be=e=>{const{buttonClasses:t,iconClasses:n}=re(()=>e),l=C(()=>M.indexOf(e.value));function s(){const r=(l()+1)%M.length;e.onChange(M[r])}return(()=>{var r=o(Re),$=r.firstChild,[d,f]=v($.nextSibling),x=d.nextSibling;return r.$$click=s,i(r,c(xe,{get class(){return n()}}),d,f),i(x,c(F,{each:M,children:(a,h)=>(()=>{var g=o(Ve);return k(()=>P(g,l()<h()?"border-primary border":"bg-primary border-primary-dark border-1")),g})()})),k(a=>{var h=t(),g=e.disabled;return h!==a.e&&P(r,a.e=h),g!==a.t&&Z(r,"disabled",a.t=g),a},{e:void 0,t:void 0}),m(),r})()};Y(["click"]);var Fe=u('<div class="h-full flex flex-col gap-4">'),He=u('<div class="grid grid-cols-4 gap-4"><!$><!/><!$><!/><!$><!/>'),Oe=u('<div class="grid grid-cols-2 gap-4 hidden">TODO: Implement auto-play<!$><!/><!$><!/>');const Je=e=>{const t=ne(e.dojoInfo.id),[n]=O(t.load,{initialValue:[]}),{lastTechnique:l,playerLoaded:s,stop:r,play:$,playing:d}=Ee(()=>e.speechPack),[f,x]=T(null);H(()=>{x(n()[0])});function a(h){const g=f();if(g==null){x(n()[0]);return}const _=q(g),p=n().findIndex(N=>q(N)===_)+h;p>=0&&p<n().length&&x(n()[p])}return(()=>{var h=o(Fe);return i(h,c(ee,{fallback:"Loading",get children(){return[c(je,{get playing(){return d()},onClickPlay:async()=>{await $(f()??n()[0]),a(1)},onClickStop:async()=>{await r(),setTimeout(()=>x(l()),10)},onClickNext:()=>a(1),onClickPrevious:()=>a(-1),get ready(){return s()}}),c(Pe,{get techniques(){return n()},get lastTechnique(){return l()},get nextTechnique(){return f()}})]}})),h})()},je=e=>{const[t,n]=T(!1),[l,s]=T("normal");return[(()=>{var r=o(He),$=r.firstChild,[d,f]=v($.nextSibling),x=d.nextSibling,[a,h]=v(x.nextSibling),g=a.nextSibling,[_,I]=v(g.nextSibling);return i(r,c(A,{label:"Previous",hideLabel:!0,size:"large",icon:ge,get disabled(){return!e.ready},get onClick(){return e.onClickPrevious}}),d,f),i(r,c(A,{class:"col-span-2",get disabled(){return!e.ready},size:"large",onClick:()=>e.playing?e.onClickStop():e.onClickPlay(),label:"Play",hideLabel:!0,get icon(){return e.playing?oe:ce}}),a,h),i(r,c(A,{label:"Next",hideLabel:!0,size:"large",icon:de,get disabled(){return!e.ready},get onClick(){return e.onClickNext}}),_,I),r})(),(()=>{var r=o(Oe),$=r.firstChild,d=$.nextSibling,[f,x]=v(d.nextSibling),a=f.nextSibling,[h,g]=v(a.nextSibling);return i(r,c(le,{size:"small",icon:$e,label:"Autoplay",get value(){return t()},onChange:n,get disabled(){return!e.ready}}),f,x),i(r,c(Be,{size:"small",get disabled(){return!t()&&!e.ready},get value(){return l()},onChange:s}),h,g),r})()]};export{Je as Reader};
