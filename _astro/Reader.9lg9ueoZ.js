import{g as c,j as _,r as b,t as u,f as k,i as o,c as r,F as U,d as q,e as T,k as Q,b as g,s as F,u as X,h as B,a as S,v as Y,l as Z,p as ee,S as te}from"./web.DKAEterj.js";import{S as V,t as ne,c as ae}from"./techniqueStore.OpD8ADmx.js";import{c as M,d as ie,S as A,C as re}from"./CheckButton.DkJ222NF.js";import{p as le,D as se}from"./playArrayBuffer.3cvR_3Ml.js";var oe=u('<svg xmlns=http://www.w3.org/2000/svg width=24 height=24><path d="M8 5v14l11-7z">');const ce=(e={})=>(()=>{var t=c(oe);return _(t,e,!0,!0),b(),t})();var ue=u('<svg xmlns=http://www.w3.org/2000/svg width=24 height=24><path d="M6 6h12v12H6z">');const de=(e={})=>(()=>{var t=c(ue);return _(t,e,!0,!0),b(),t})();var he=u('<svg xmlns=http://www.w3.org/2000/svg width=24 height=24><path d="m6 18 8.5-6L6 6zM16 6v12h2V6z">');const ge=(e={})=>(()=>{var t=c(he);return _(t,e,!0,!0),b(),t})();var xe=u('<svg xmlns=http://www.w3.org/2000/svg width=24 height=24><path d="M6 6h2v12H6zm3.5 6 8.5 6V6z">');const ye=(e={})=>(()=>{var t=c(xe);return _(t,e,!0,!0),b(),t})();var ve=u('<svg xmlns=http://www.w3.org/2000/svg width=24 height=24><path d="M19.03 3.56c-1.67-1.39-3.74-2.3-6.03-2.51v2.01c1.73.19 3.31.88 4.61 1.92zM11 3.06V1.05c-2.29.2-4.36 1.12-6.03 2.51l1.42 1.42A8.93 8.93 0 0 1 11 3.06M4.98 6.39 3.56 4.97C2.17 6.64 1.26 8.71 1.05 11h2.01c.19-1.73.88-3.31 1.92-4.61M20.94 11h2.01c-.21-2.29-1.12-4.36-2.51-6.03l-1.42 1.42A8.93 8.93 0 0 1 20.94 11M7 12l3.44 1.56L12 17l1.56-3.44L17 12l-3.44-1.56L12 7l-1.56 3.44z"></path><path d="M12 21a8.96 8.96 0 0 1-7.46-4H7v-2H1v6h2v-2.7c1.99 2.84 5.27 4.7 9 4.7 4.87 0 9-3.17 10.44-7.56l-1.96-.45C19.25 18.48 15.92 21 12 21">');const $e=(e={})=>(()=>{var t=c(ve);return _(t,e,!0,!0),b(),t})();var fe=u('<svg xmlns=http://www.w3.org/2000/svg width=24 height=24><path d="m20.38 8.57-1.23 1.85a8 8 0 0 1-.22 7.58H5.07A8 8 0 0 1 15.58 6.85l1.85-1.23A10 10 0 0 0 3.35 19a2 2 0 0 0 1.72 1h13.85a2 2 0 0 0 1.74-1 10 10 0 0 0-.27-10.44z"></path><path d="M10.59 15.41a2 2 0 0 0 2.83 0l5.66-8.49-8.49 5.66a2 2 0 0 0 0 2.83">');const pe=(e={})=>(()=>{var t=c(fe);return _(t,e,!0,!0),b(),t})();var we=u('<svg xmlns=http://www.w3.org/2000/svg width=24 height=24><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"></path><path d="M15.97 11.03C14.87 9.79 13.28 9 11.5 9c-2.82 0-5.18 1.95-5.82 4.56l.96.32C7.15 11.66 9.13 10 11.5 10c1.51 0 2.85.68 3.76 1.74L13 14h5V9z">');const be=(e={})=>(()=>{var t=c(we);return _(t,e,!0,!0),b(),t})(),me=["execution","attack","defence","direction"];function E(e){return`${e.execution} ${e.attack} ${e.defence} ${e.direction}`.replace(/\W/g,"_")}const _e=["execution","attack","defence"];function D(e,t){const n=e.direction===V?_e:me;return t==null?n:e.execution!==t.execution?n.slice(0):e.attack!==t.attack?n.slice(1):e.defence!==t.defence?n.slice(2):e.direction!==t.direction?n.slice(3):n}function*Pe(e){let t;for(const n of e){const a=D(n,t);yield{id:E(n),execution:{value:n.execution,relevant:a.includes("execution")},attack:{value:n.attack,relevant:a.includes("attack")},defence:{value:n.defence,relevant:a.includes("defence")},direction:{value:n.direction,relevant:a.includes("direction")}},t=n}}var Se=u("<ul>"),ke=u("<li><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/>"),Ce=u('<div class="absolute flex items-center top-0 right-0 rounded bg-primary-dark font-bold text-white p-1 origin-top-right text-xs"><!$><!/> <!$><!/>'),qe=u("<div>");const Te=e=>{const t=k(()=>Array.from(Pe(e.techniques)));return(()=>{var n=c(Se);return o(n,r(U,{get each(){return t()},children:a=>r(Ne,{entry:a,get isLastTechnique(){return k(()=>e.lastTechnique!=null)()&&a.id==E(e.lastTechnique)},get isNextTechnique(){return k(()=>e.nextTechnique!=null)()&&a.id==E(e.nextTechnique)}})})),q(()=>T(n,M("overflow-y-scroll grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 shadow-lg m-0 bg-white",e.class))),n})()},Ne=e=>{let t;return Q(()=>{e.isNextTechnique&&t.scrollIntoView?.({block:"end",inline:"start",behavior:"smooth"})}),(()=>{var n=c(ke),a=n.firstChild,[l,i]=g(a.nextSibling),x=l.nextSibling,[h,y]=g(x.nextSibling),$=h.nextSibling,[d,v]=g($.nextSibling),s=d.nextSibling,[f,p]=g(s.nextSibling),P=f.nextSibling,[H,j]=g(P.nextSibling),R=t;return typeof R=="function"?X(R,n):t=n,o(n,(()=>{var w=k(()=>!!e.isNextTechnique);return()=>w()&&(()=>{var m=c(Ce),N=m.firstChild,[C,O]=g(N.nextSibling),W=C.nextSibling,G=W.nextSibling,[J,K]=g(G.nextSibling);return o(m,r(be,{class:"fill-current scale-75"}),C,O),o(m,()=>ne("reader.upcoming-technique"),J,K),m})()})(),l,i),o(n,r(I,{get field(){return e.entry.execution},class:"text-sm h-6"}),h,y),o(n,r(I,{get field(){return e.entry.attack},class:"text-sm h-6 z-10"}),d,v),o(n,r(I,{get field(){return e.entry.defence},class:"text-xl h-8"}),f,p),o(n,r(I,{get field(){return e.entry.direction},class:"text-sm h-6"}),H,j),q(w=>{var m=e.entry.id,N=M(e.isLastTechnique&&"bg-primary-lightest outline-primary outline-4 -outline-offset-4","border-primary-light border p-2 pt-4 rounded snap-mandatory","snap-start","relative","overflow-visible","list-none","h-32"),C=e.isLastTechnique;return m!==w.e&&F(n,"id",w.e=m),N!==w.t&&T(n,w.t=N),C!==w.a&&F(n,"aria-current",w.a=C),w},{e:void 0,t:void 0,a:void 0}),n})()},I=e=>(()=>{var t=c(qe);return o(t,()=>e.field.value!==V&&e.field.value),q(()=>T(t,M(e.field.relevant?"text-black font-bold":"text-secondary",e.class))),t})(),Ie=console.warn.bind(console);async function Le(e){return Ae(e,async t=>{for(let l=0;l<2;l++)try{const i=new URL(t,window.location.href);return await(await fetch(i)).arrayBuffer()}catch(i){Ie("Retrying after ",i)}const n=new URL(t,window.location.href);return await(await fetch(n)).arrayBuffer()})}async function Ae(e,t){const n=Object.entries(e),a=await Promise.all(n.map(async([l,i])=>[l,await t(i)]));return Object.fromEntries(a)}let z=null;async function Ee(e,t){if(z==null)throw new Error("No SpeechPack loaded");await le(z[e],{abortSignal:t})}async function ze(e){z=await Le(e)}function Me(e,t){return D(e,t).map(a=>e[a])}class Re{constructor(){this.lastTechnique=void 0,this.abortController=new AbortController}async playTechnique(t){await this.playFiles(Me(t,this.lastTechnique)),this.abortController.signal.aborted||(this.lastTechnique=t)}async playFiles(t){this.abortController.abort();const n=new AbortController;this.abortController=n;for(const a of t){if(n.signal.aborted)return;await Ee(a,n.signal)}}async stop(){this.abortController.abort()}}class Fe{constructor(t,n={}){this.alive=!0,this.speechPackPlayer=new Re,this.techniques=t,this.options=n,this.nextIndex=0,this.lastIndex=-1,this.autoPlayEnabled=!1,this.options.onUpdateNextTechnique?.(this.techniques[this.nextIndex])}async play(){await this.playNext(),this.autoPlayEnabled&&this.techniques[this.nextIndex]!=null&&(await this.options.waitSeconds?.(20),await this.play())}async playNext(){this.options.onStart?.();try{this.updateLastFromNext();const t=this.getNextTechnique();if(t==null)return;await this.speechPackPlayer.playTechnique(t)}finally{this.options.onStop?.()}await this.skipNext()}updateLastFromNext(){this.options.onUpdateLastTechnique?.(this.getNextTechnique()),this.lastIndex=this.nextIndex}getNextTechnique(){return this.techniques[this.nextIndex]}async stop(){await this.speechPackPlayer.stop()}setAutoPlay(t){this.autoPlayEnabled=t,this.options.onAutoPlay?.(t)}async skipNext(){this.nextIndex++,this.options.onUpdateNextTechnique?.(this.techniques[this.nextIndex])}async skipPrevious(){this.nextIndex--,this.options.onUpdateNextTechnique?.(this.techniques[this.nextIndex])}destroy(){this.alive=!1}}function Ue(e,t,n){const[a]=B(async()=>(await ze(e()),!0)),[l,i]=S(!1),[x,h]=S(!1),[y,$]=S(null),[d,v]=S(null),s=k(()=>{const f=new Fe(t(),{onStart:()=>h(!0),onStop:()=>h(!1),onAutoPlay:i,onUpdateNextTechnique:p=>v(p),onUpdateLastTechnique:p=>$(p),waitSeconds:n});return Y(()=>f.destroy()),f});return{autoPlay:l,setAutoPlay(f){s().setAutoPlay(f)},playing:x,playerLoaded:a,lastTechnique:y,nextTechnique:d,async play(){await s().play()},async stop(){await s().stop()},async skipPrevious(){await s().skipPrevious()},async skipNext(){await s().skipNext()}}}var Be=u('<button><!$><!/><div class="grid grid-cols-3 w-24 gap-1 h-6">'),Ve=u("<div>");const L=["slow","normal","fast"],De=e=>{const{buttonClasses:t,iconClasses:n}=ie(()=>e),a=k(()=>L.indexOf(e.value));function l(){const i=(a()+1)%L.length;e.onChange(L[i])}return(()=>{var i=c(Be),x=i.firstChild,[h,y]=g(x.nextSibling),$=h.nextSibling;return i.$$click=l,o(i,r(pe,{get class(){return n()}}),h,y),o($,r(U,{each:L,children:(d,v)=>(()=>{var s=c(Ve);return q(()=>T(s,a()<v()?"border-primary border":"bg-primary border-primary-dark border-1")),s})()})),q(d=>{var v=t(),s=e.disabled;return v!==d.e&&T(i,d.e=v),s!==d.t&&ee(i,"disabled",d.t=s),d},{e:void 0,t:void 0}),b(),i})()};Z(["click"]);var He=u('<div class="h-full flex flex-col gap-4">'),je=u('<div class="grid grid-cols-4 gap-4"><!$><!/><!$><!/><!$><!/>'),Oe=u('<div class="grid grid-cols-2 gap-4"><!$><!/><!$><!/>');const Xe=e=>{const t=ae(e.dojoInfo.id),[n]=B(t.load,{initialValue:[]}),[a,l]=S(),{lastTechnique:i,nextTechnique:x,skipNext:h,skipPrevious:y,playerLoaded:$,stop:d,play:v,playing:s,setAutoPlay:f,autoPlay:p}=Ue(()=>e.speechPack,n,async P=>{await a()?.animateDelay(P)});return(()=>{var P=c(He);return o(P,r(te,{fallback:"Loading",get children(){return[r(We,{get playing(){return s()},onClickPlay:async()=>{await v()},onClickStop:async()=>{f(!1),await d()},onClickNext:()=>h(),onClickPrevious:()=>y(),get ready(){return $()},onClickAutoPlay:()=>f(!p()),get autoPlayEnabled(){return p()}}),r(se,{setDelayControl:l,get disabled(){return!p()}}),r(Te,{class:"flex-1",get techniques(){return n()},get lastTechnique(){return i()},get nextTechnique(){return x()}})]}})),P})()},We=e=>{const[t,n]=S("normal");return[(()=>{var a=c(je),l=a.firstChild,[i,x]=g(l.nextSibling),h=i.nextSibling,[y,$]=g(h.nextSibling),d=y.nextSibling,[v,s]=g(d.nextSibling);return o(a,r(A,{label:"Previous",hideLabel:!0,size:"large",icon:ye,get disabled(){return!e.ready},get onClick(){return e.onClickPrevious}}),i,x),o(a,r(A,{class:"col-span-2",get disabled(){return!e.ready},size:"large",onClick:()=>e.playing?e.onClickStop():e.onClickPlay(),get label(){return e.playing?"Stop":"Play"},hideLabel:!0,get icon(){return e.playing?de:ce}}),y,$),o(a,r(A,{label:"Next",hideLabel:!0,size:"large",icon:ge,get disabled(){return!e.ready},get onClick(){return e.onClickNext}}),v,s),a})(),(()=>{var a=c(Oe),l=a.firstChild,[i,x]=g(l.nextSibling),h=i.nextSibling,[y,$]=g(h.nextSibling);return o(a,r(re,{size:"small",icon:$e,label:"Autoplay",get value(){return e.autoPlayEnabled},get onChange(){return e.onClickAutoPlay},get disabled(){return!e.ready}}),i,x),o(a,r(De,{class:"hidden",size:"small",get disabled(){return!e.autoPlayEnabled&&!e.ready},get value(){return t()},onChange:n}),y,$),a})()]};export{Xe as Reader};
