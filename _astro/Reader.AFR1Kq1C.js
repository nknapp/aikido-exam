import{g as o,j as _,r as p,t as s,f as T,i as l,c,F as K,d as z,e as E,k as A,b as u,s as F,u as Q,h as B,a as L,S as X}from"./web.Br82kJRb.js";import{S as j,t as Y,c as Z}from"./techniqueStore.OpD8ADmx.js";import{c as R,S as I}from"./SimpleButton.BAX8mLDH.js";import{p as ee}from"./playArrayBuffer.D6vWLOse.js";var te=s('<svg xmlns=http://www.w3.org/2000/svg width=24 height=24><path d="M8 5v14l11-7z">');const ne=(e={})=>(()=>{var t=o(te);return _(t,e,!0,!0),p(),t})();var re=s('<svg xmlns=http://www.w3.org/2000/svg width=24 height=24><path d="M6 19h4V5H6zm8-14v14h4V5z">');const ie=(e={})=>(()=>{var t=o(re);return _(t,e,!0,!0),p(),t})();var ae=s('<svg xmlns=http://www.w3.org/2000/svg width=24 height=24><path d="m6 18 8.5-6L6 6zM16 6v12h2V6z">');const le=(e={})=>(()=>{var t=o(ae);return _(t,e,!0,!0),p(),t})();var ce=s('<svg xmlns=http://www.w3.org/2000/svg width=24 height=24><path d="M6 6h2v12H6zm3.5 6 8.5 6V6z">');const oe=(e={})=>(()=>{var t=o(ce);return _(t,e,!0,!0),p(),t})();var se=s('<svg xmlns=http://www.w3.org/2000/svg width=24 height=24><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"></path><path d="M15.97 11.03C14.87 9.79 13.28 9 11.5 9c-2.82 0-5.18 1.95-5.82 4.56l.96.32C7.15 11.66 9.13 10 11.5 10c1.51 0 2.85.68 3.76 1.74L13 14h5V9z">');const ue=(e={})=>(()=>{var t=o(se);return _(t,e,!0,!0),p(),t})(),de=["execution","attack","defence","direction"];function m(e){return`${e.execution} ${e.attack} ${e.defence} ${e.direction}`.replace(/\W/g,"_")}const he=["execution","attack","defence"];function H(e,t){const n=e.direction===j?he:de;return t==null?n:e.execution!==t.execution?n.slice(0):e.attack!==t.attack?n.slice(1):e.defence!==t.defence?n.slice(2):e.direction!==t.direction?n.slice(3):n}function*ge(e){let t;for(const n of e){const r=H(n,t);yield{id:m(n),execution:{value:n.execution,relevant:r.includes("execution")},attack:{value:n.attack,relevant:r.includes("attack")},defence:{value:n.defence,relevant:r.includes("defence")},direction:{value:n.direction,relevant:r.includes("direction")}},t=n}}var fe=s("<ul>"),ve=s("<li><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/>"),$e=s('<div class="absolute flex items-center top-0 right-0 rounded bg-primary-dark font-bold text-white p-1 origin-top-right text-xs"><!$><!/> <!$><!/>'),xe=s("<div>");const ye=e=>{const t=T(()=>Array.from(ge(e.techniques)));return(()=>{var n=o(fe);return l(n,c(K,{get each(){return t()},children:r=>c(we,{entry:r,get isLastTechnique(){return T(()=>e.lastTechnique!=null)()&&r.id==m(e.lastTechnique)},get isNextTechnique(){return T(()=>e.nextTechnique!=null)()&&r.id==m(e.nextTechnique)}})})),z(()=>E(n,R("overflow-x-visible overflow-y-scroll grid gap-2 snap-y shadow-lg m-0 py-2 bg-white",e.class))),n})()},we=e=>{let t;return A(()=>{e.isNextTechnique&&t.scrollIntoView?.({block:"end",behavior:"smooth"})}),(()=>{var n=o(ve),r=n.firstChild,[i,a]=u(r.nextSibling),d=i.nextSibling,[h,$]=u(d.nextSibling),f=h.nextSibling,[v,y]=u(f.nextSibling),S=v.nextSibling,[k,M]=u(S.nextSibling),w=k.nextSibling,[q,O]=u(w.nextSibling),V=t;return typeof V=="function"?Q(V,n):t=n,l(n,(()=>{var g=T(()=>!!e.isNextTechnique);return()=>g()&&(()=>{var x=o($e),C=x.firstChild,[b,W]=u(C.nextSibling),D=b.nextSibling,U=D.nextSibling,[G,J]=u(U.nextSibling);return l(x,c(ue,{class:"fill-current scale-75"}),b,W),l(x,()=>Y("reader.upcoming-technique"),G,J),x})()})(),i,a),l(n,c(P,{get field(){return e.entry.execution},class:"text-sm h-6"}),h,$),l(n,c(P,{get field(){return e.entry.attack},class:"text-sm h-6 z-10"}),v,y),l(n,c(P,{get field(){return e.entry.defence},class:"text-xl h-8"}),k,M),l(n,c(P,{get field(){return e.entry.direction},class:"text-sm h-6"}),q,O),z(g=>{var x=e.entry.id,C=R(e.isLastTechnique&&"bg-primary-lightest outline-primary outline-4 -outline-offset-4","border-primary-light border p-2 pt-4 rounded snap-mandatory","snap-start","relative","overflow-visible","list-none","h-32"),b=e.isLastTechnique;return x!==g.e&&F(n,"id",g.e=x),C!==g.t&&E(n,g.t=C),b!==g.a&&F(n,"aria-current",g.a=b),g},{e:void 0,t:void 0,a:void 0}),n})()},P=e=>(()=>{var t=o(xe);return l(t,()=>e.field.value!==j&&e.field.value),z(()=>E(t,R(e.field.relevant?"text-black font-bold":"text-secondary",e.class))),t})();function be(e,t){return H(e,t).map(r=>e[r])}const me=console.warn.bind(console);async function _e(e){return pe(e,async t=>{for(let i=0;i<2;i++)try{const a=new URL(t,window.location.href);return await(await fetch(a)).arrayBuffer()}catch(a){me("Retrying after ",a)}const n=new URL(t,window.location.href);return await(await fetch(n)).arrayBuffer()})}async function pe(e,t){const n=Object.entries(e),r=await Promise.all(n.map(async([i,a])=>[i,await t(a)]));return Object.fromEntries(r)}let N=null;async function Se(e,t){if(N==null)throw new Error("No SpeechPack loaded");await ee(N[e],{abortSignal:t})}async function ke(e){N=await _e(e)}class Ce{constructor(){this.lastTechnique=void 0,this.abortController=new AbortController}async playTechnique(t){await this.playFiles(be(t,this.lastTechnique)),this.abortController.signal.aborted||(this.lastTechnique=t)}async playFiles(t){this.abortController.abort();const n=new AbortController;this.abortController=n;for(const r of t){if(n.signal.aborted)return;await Se(r,n.signal)}}async stop(){this.abortController.abort()}}function Pe(e){const[t]=B(async()=>(await ke(e()),!0)),[n,r]=L(!1),i=new Ce,[a,d]=L(null);return{playing:n,playerLoaded:t,lastTechnique:a,async play(h){r(!0),d(h),await i.playTechnique(h),r(!1)},async stop(){await i.stop()}}}var Te=s('<div class="flex flex-col gap-4">'),qe=s('<div class="grid grid-cols-3 gap-4"><!$><!/><!$><!/><!$><!/>');const Re=e=>{const t=Z(e.dojoInfo.id),[n]=B(t.load,{initialValue:[]}),{lastTechnique:r,playerLoaded:i,stop:a,play:d,playing:h}=Pe(()=>e.speechPack),[$,f]=L(null);A(()=>{f(n()[0])});function v(y){const S=$();if(S==null){f(n()[0]);return}const k=m(S),w=n().findIndex(q=>m(q)===k)+y;w>=0&&w<n().length&&f(n()[w])}return(()=>{var y=o(Te);return l(y,c(X,{fallback:"Loading",get children(){return[c(Ie,{get playing(){return h()},onClickPlay:async()=>{await d($()??n()[0]),v(1)},onClickStop:async()=>{await a(),setTimeout(()=>f(r()),10)},onClickNext:()=>v(1),onClickPrevious:()=>v(-1),get ready(){return i()}}),c(ye,{class:"h-[60vh]",get techniques(){return n()},get lastTechnique(){return r()},get nextTechnique(){return $()}})]}})),y})()},Ie=e=>(()=>{var t=o(qe),n=t.firstChild,[r,i]=u(n.nextSibling),a=r.nextSibling,[d,h]=u(a.nextSibling),$=d.nextSibling,[f,v]=u($.nextSibling);return l(t,c(I,{label:"Previous",hideLabel:!0,size:"large",icon:oe,get disabled(){return!e.ready},get onClick(){return e.onClickPrevious}}),r,i),l(t,c(I,{get disabled(){return!e.ready},size:"large",onClick:()=>e.playing?e.onClickStop():e.onClickPlay(),label:"Play",hideLabel:!0,get icon(){return e.playing?ie:ne}}),d,h),l(t,c(I,{label:"Next",hideLabel:!0,size:"large",icon:le,get disabled(){return!e.ready},get onClick(){return e.onClickNext}}),f,v),t})();export{Re as Reader};
